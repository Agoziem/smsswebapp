# Generated by Django 2.2 on 2024-12-14 08:04

from django.db import migrations
import random


def regenerate_student_pins(apps, schema_editor):
    # Get the Student model
    Students_Pin_and_ID = apps.get_model('Result_portal', 'Students_Pin_and_ID')
    
    # Iterate through all Student instances
    for student in Students_Pin_and_ID.objects.all():
        attempts = 0
        while attempts < 5:  # Limit the number of attempts to avoid infinite loop
            random_14_digit = str(random.randint(10**13, 10**14 - 1))
            # Ensure the new pin is unique
            if not Students_Pin_and_ID.objects.filter(student_pin=random_14_digit).exists():
                student.student_pin = random_14_digit
                student.save()
                break
            attempts += 1
        else:
            raise ValueError("Unable to generate a unique student PIN")
        

class Migration(migrations.Migration):

    dependencies = [
        ('Result_portal', '0032_remove_students_pin_and_id_student_class'),
    ]

    operations = [
        migrations.RunPython(regenerate_student_pins),
    ]
