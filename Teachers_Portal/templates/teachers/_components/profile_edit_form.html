<!-- Profile Edit Form Component -->
<div class="bg-base-100 rounded-xl shadow-lg p-6">
  <div class="mb-6">
    <h3 class="text-lg font-bold text-primary flex items-center gap-2">
      <i class="fas fa-user-edit"></i>
      Personal Information
    </h3>
    <p class="text-sm text-base-content/70 mt-2">Update your personal and professional details</p>
  </div>

  <!-- Alert Container -->
  <div id="profile-alert-container" class="mb-6"></div>

  <form id="profile-edit-form" 
        action="{% url 'Teachers_portal:profile' id=teacher.id %}" 
        method="post" 
        class="space-y-6"
        hx-post="/api/update-teacher-profile"
        hx-target="#profile-alert-container"
        hx-swap="innerHTML">
    {% csrf_token %}

    <!-- Name Fields -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div class="form-control">
        <label class="label">
          <span class="label-text font-medium">First Name</span>
          <span class="label-text-alt text-error">*</span>
        </label>
        <input type="text" name="FirstName" 
               value="{{ teacher.FirstName|default:'John' }}" 
               class="input input-bordered focus:outline-orange focus:border-orange" 
               placeholder="e.g. John" required 
               hx-validate="true" />
        <label class="label">
          <span class="label-text-alt text-error hidden" id="firstname-error">
            <i class="fas fa-exclamation-circle mr-1"></i>Please provide a valid first name
          </span>
        </label>
      </div>

      <div class="form-control">
        <label class="label">
          <span class="label-text font-medium">Last Name</span>
          <span class="label-text-alt text-error">*</span>
        </label>
        <input type="text" name="LastName" 
               value="{{ teacher.LastName|default:'Doe' }}" 
               class="input input-bordered focus:outline-orange focus:border-orange" 
               placeholder="e.g. Doe" required 
               hx-validate="true" />
        <label class="label">
          <span class="label-text-alt text-error hidden" id="lastname-error">
            <i class="fas fa-exclamation-circle mr-1"></i>Please provide a valid last name
          </span>
        </label>
      </div>
    </div>

    <!-- Contact Information -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div class="form-control">
        <label class="label">
          <span class="label-text font-medium">Email Address</span>
        </label>
        <input type="email" name="Email" 
               value="{{ teacher.Email|default:'john.doe@school.edu' }}" 
               class="input input-bordered focus:outline-orange focus:border-orange" 
               placeholder="your.email@example.com" 
               hx-validate="true" />
        <label class="label">
          <span class="label-text-alt text-info">
            <i class="fas fa-info-circle mr-1"></i>Optional but recommended for notifications
          </span>
        </label>
      </div>

      <div class="form-control">
        <label class="label">
          <span class="label-text font-medium">Phone Number</span>
          <span class="label-text-alt text-error">*</span>
        </label>
        <input type="tel" name="Phone_number" 
               value="{{ teacher.Phone_number|default:'+234 800 123 4567' }}" 
               class="input input-bordered focus:outline-orange focus:border-orange" 
               placeholder="+234 800 123 4567" required 
               hx-validate="true" />
        <label class="label">
          <span class="label-text-alt text-error hidden" id="phone-error">
            <i class="fas fa-exclamation-circle mr-1"></i>Please enter a valid phone number
          </span>
        </label>
      </div>
    </div>

    <!-- Professional Information -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div class="form-control">
        <label class="label">
          <span class="label-text font-medium">Role</span>
          <span class="label-text-alt text-error">*</span>
        </label>
        <select name="Role" 
                class="select select-bordered focus:outline-orange focus:border-orange" 
                required
                hx-post="/api/check-role-permissions"
                hx-target="#role-permissions-info"
                hx-trigger="change">
          <option value="Teacher" {% if teacher.Role == "Teacher" %}selected{% endif %}>Teacher</option>
          <option value="Formteacher" {% if teacher.Role == "Formteacher" %}selected{% endif %}>Form Teacher</option>
          <option value="Admin" {% if teacher.Role == "Admin" %}selected{% endif %}>Admin</option>
          <option value="HOD" {% if teacher.Role == "HOD" %}selected{% endif %}>Head of Department</option>
        </select>
        <label class="label">
          <span class="label-text-alt text-info" id="role-permissions-info">
            <!-- Role permissions info will be loaded here -->
            <i class="fas fa-info-circle mr-1"></i>Select your primary role in the school
          </span>
        </label>
      </div>
      
      <div class="form-control" id="classFormedContainer" 
           style="{% if teacher.Role != 'Formteacher' %}display: none;{% endif %}">
        <label class="label">
          <span class="label-text font-medium">Class Formed</span>
          <span class="label-text-alt text-info">(For Form Teachers)</span>
        </label>
        <select id="classFormedSelect" 
                class="select select-bordered focus:outline-orange focus:border-orange" 
                name="classFormed"
                hx-get="/api/get-class-students"
                hx-target="#class-students-info"
                hx-trigger="change">
          <option value="">Select a class</option>
          <!-- Dummy data for classes -->
          <option value="1" {% if teacher.classFormed.id == 1 %}selected{% endif %}>SS1A</option>
          <option value="2" {% if teacher.classFormed.id == 2 %}selected{% endif %}>SS1B</option>
          <option value="3" {% if teacher.classFormed.id == 3 %}selected{% endif %}>SS2A</option>
          <option value="4" {% if teacher.classFormed.id == 4 %}selected{% endif %}>SS2B</option>
          <option value="5" {% if teacher.classFormed.id == 5 %}selected{% endif %}>SS3A</option>
          <option value="6" {% if teacher.classFormed.id == 6 %}selected{% endif %}>SS3B</option>
          <option value="7" {% if teacher.classFormed.id == 7 %}selected{% endif %}>JSS1A</option>
          <option value="8" {% if teacher.classFormed.id == 8 %}selected{% endif %}>JSS2A</option>
          <option value="9" {% if teacher.classFormed.id == 9 %}selected{% endif %}>JSS3A</option>
        </select>
        <label class="label">
          <span class="label-text-alt text-info" id="class-students-info">
            <!-- Class student count will be loaded here -->
          </span>
        </label>
      </div>
    </div>

    <!-- Classes and Subjects -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div class="form-control">
        <label class="label">
          <span class="label-text font-medium">Classes Taught</span>
          <span class="label-text-alt text-error">*</span>
        </label>
        <p class="text-xs text-base-content/60 mb-2">You can select multiple classes (Hold Ctrl/Cmd to select multiple)</p>
        <select name="classes_taught" multiple 
                class="select select-bordered h-32 focus:outline-orange focus:border-orange" 
                required
                hx-post="/api/update-teaching-load"
                hx-target="#teaching-load-summary"
                hx-trigger="change">
          <!-- Dummy data for classes -->
          <option value="1" {% if 1 in teacher.classes_taught.all.values_list %}selected{% endif %}>SS1A - Senior Secondary 1A</option>
          <option value="2" {% if 2 in teacher.classes_taught.all.values_list %}selected{% endif %}>SS1B - Senior Secondary 1B</option>
          <option value="3" {% if 3 in teacher.classes_taught.all.values_list %}selected{% endif %}>SS2A - Senior Secondary 2A</option>
          <option value="4" {% if 4 in teacher.classes_taught.all.values_list %}selected{% endif %}>SS2B - Senior Secondary 2B</option>
          <option value="5" {% if 5 in teacher.classes_taught.all.values_list %}selected{% endif %}>SS3A - Senior Secondary 3A</option>
          <option value="6" {% if 6 in teacher.classes_taught.all.values_list %}selected{% endif %}>SS3B - Senior Secondary 3B</option>
          <option value="7" {% if 7 in teacher.classes_taught.all.values_list %}selected{% endif %}>JSS1A - Junior Secondary 1A</option>
          <option value="8" {% if 8 in teacher.classes_taught.all.values_list %}selected{% endif %}>JSS2A - Junior Secondary 2A</option>
          <option value="9" {% if 9 in teacher.classes_taught.all.values_list %}selected{% endif %}>JSS3A - Junior Secondary 3A</option>
        </select>
        <label class="label">
          <span class="label-text-alt text-error hidden" id="classes-error">
            <i class="fas fa-exclamation-circle mr-1"></i>Please select at least one class
          </span>
        </label>
      </div>

      <div class="form-control">
        <label class="label">
          <span class="label-text font-medium">Subjects Taught</span>
          <span class="label-text-alt text-error">*</span>
        </label>
        <p class="text-xs text-base-content/60 mb-2">You can select multiple subjects (Hold Ctrl/Cmd to select multiple)</p>
        <select name="subjects_taught" multiple 
                class="select select-bordered h-32 focus:outline-orange focus:border-orange" 
                required
                hx-post="/api/update-subject-load"
                hx-target="#subject-load-summary"
                hx-trigger="change">
          <!-- Dummy data for subjects -->
          <option value="1" {% if 1 in teacher.subjects_taught.all.values_list %}selected{% endif %}>Mathematics</option>
          <option value="2" {% if 2 in teacher.subjects_taught.all.values_list %}selected{% endif %}>English Language</option>
          <option value="3" {% if 3 in teacher.subjects_taught.all.values_list %}selected{% endif %}>Physics</option>
          <option value="4" {% if 4 in teacher.subjects_taught.all.values_list %}selected{% endif %}>Chemistry</option>
          <option value="5" {% if 5 in teacher.subjects_taught.all.values_list %}selected{% endif %}>Biology</option>
          <option value="6" {% if 6 in teacher.subjects_taught.all.values_list %}selected{% endif %}>Geography</option>
          <option value="7" {% if 7 in teacher.subjects_taught.all.values_list %}selected{% endif %}>Economics</option>
          <option value="8" {% if 8 in teacher.subjects_taught.all.values_list %}selected{% endif %}>Government</option>
          <option value="9" {% if 9 in teacher.subjects_taught.all.values_list %}selected{% endif %}>Literature</option>
          <option value="10" {% if 10 in teacher.subjects_taught.all.values_list %}selected{% endif %}>History</option>
          <option value="11" {% if 11 in teacher.subjects_taught.all.values_list %}selected{% endif %}>Computer Science</option>
          <option value="12" {% if 12 in teacher.subjects_taught.all.values_list %}selected{% endif %}>Agricultural Science</option>
        </select>
        <label class="label">
          <span class="label-text-alt text-error hidden" id="subjects-error">
            <i class="fas fa-exclamation-circle mr-1"></i>Please select at least one subject
          </span>
        </label>
      </div>
    </div>

    <!-- Teaching Load Summary -->
    <div class="bg-base-200 rounded-lg p-4" id="teaching-load-summary">
      <h4 class="font-semibold text-primary mb-3 flex items-center gap-2">
        <i class="fas fa-chart-bar"></i>
        Teaching Load Summary
      </h4>
      <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 text-sm">
        <div class="bg-base-100 rounded p-3">
          <div class="text-base-content/70">Classes</div>
          <div class="font-bold text-lg text-primary" id="total-classes">3</div>
        </div>
        <div class="bg-base-100 rounded p-3">
          <div class="text-base-content/70">Subjects</div>
          <div class="font-bold text-lg text-secondary" id="total-subjects">2</div>
        </div>
        <div class="bg-base-100 rounded p-3">
          <div class="text-base-content/70">Est. Students</div>
          <div class="font-bold text-lg text-accent" id="total-students">125</div>
        </div>
        <div class="bg-base-100 rounded p-3">
          <div class="text-base-content/70">Weekly Hours</div>
          <div class="font-bold text-lg text-info" id="weekly-hours">18</div>
        </div>
      </div>
    </div>

    <!-- Additional Information -->
    <div class="form-control">
      <label class="label">
        <span class="label-text font-medium">Additional Information</span>
        <span class="label-text-alt text-info">Optional</span>
      </label>
      <textarea class="textarea textarea-bordered h-24 focus:outline-orange focus:border-orange" 
                name="additional_info"
                placeholder="Any additional qualifications, certifications, or notes...">{{ teacher.additional_info|default:"Bachelor's Degree in Mathematics Education, 5 years teaching experience." }}</textarea>
      <label class="label">
        <span class="label-text-alt text-base-content/60">
          <i class="fas fa-info-circle mr-1"></i>Include qualifications, certifications, or special skills
        </span>
      </label>
    </div>

    <!-- Confirmation and Submit -->
    <div class="form-control">
      <label class="cursor-pointer label justify-start gap-3">
        <input type="checkbox" class="checkbox checkbox-primary" required />
        <span class="label-text">I have reviewed my submission and confirm all information is accurate</span>
      </label>
    </div>

    <!-- Form Actions -->
    <div class="flex flex-col sm:flex-row justify-end gap-4">
      <button type="button" class="btn btn-ghost order-2 sm:order-1">
        <i class="fas fa-times mr-2"></i>
        Cancel
      </button>
      <button type="submit" class="btn btn-primary order-1 sm:order-2">
        <span class="loading loading-spinner loading-sm hidden" id="save-spinner"></span>
        <i class="fas fa-save mr-2"></i>
        Save Changes
      </button>
    </div>
  </form>
</div>

<script>
// Real-time form validation and interactions
document.addEventListener('DOMContentLoaded', function() {
  const roleSelect = document.querySelector('select[name="Role"]');
  const classFormedContainer = document.getElementById('classFormedContainer');
  
  // Handle role change for form teacher class assignment
  if (roleSelect) {
    roleSelect.addEventListener('change', function() {
      if (this.value === 'Formteacher') {
        classFormedContainer.style.display = 'block';
      } else {
        classFormedContainer.style.display = 'none';
      }
    });
  }
  
  // Form submission handling
  const form = document.getElementById('profile-edit-form');
  if (form) {
    form.addEventListener('submit', function(e) {
      const spinner = document.getElementById('save-spinner');
      const submitBtn = e.target.querySelector('button[type="submit"]');
      
      spinner.classList.remove('hidden');
      submitBtn.disabled = true;
    });
  }
});
</script>
