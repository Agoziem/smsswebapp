{% extends '_layouts/dashboard_layout.html' %} 
{% load static %} 
{% block dashboard_content %}

<!-- Page Content -->
<div class="mb-8">
  <!-- Breadcrumb -->
  <div class="breadcrumbs text-sm mb-4">
    <ul>
      <li><a href="{% url 'Teachers_portal:Teachers_dashboard' %}" class="text-primary hover:text-primary/80">Dashboard</a></li>
      <li class="text-base-content">Annual Result Analytics</li>
    </ul>
  </div>

  <!-- Page Header -->
  <div class="space-y-2 text-center">
    <h1 class="text-2xl md:text-3xl font-bold text-primary">Annual Result Publishing</h1>
    {% if teacher.FirstName == "None" %}
    <div class="bg-warning/10 border border-warning/20 rounded-lg p-4 max-w-md mx-auto">
      <div class="flex items-center gap-3">
        <i class="fas fa-exclamation-triangle text-warning text-lg"></i>
        <div>
          <p class="font-medium text-warning">Profile Incomplete</p>
          <p class="text-sm text-warning/80">
            <a href="{% url 'Teachers_portal:profile' teacher.id %}" class="link link-hover underline">
              Edit your Teachers Profile to perform further actions
            </a>
          </p>
        </div>
      </div>
    </div>
    {% else %}
    <div class="flex items-center justify-center gap-3">
      <div class="badge badge-success badge-lg">{{ class.Class }} Class Result Table</div>
    </div>
    <input class="classinput hidden" type="text" value="{{ class.Class }}" />
    <input class="subjectlist hidden" type="text" value="{{ sub_list }}" />
    {% endif %}
    
    <!-- Result Badge -->
    <div id="resultbadge" class="badge badge-success rounded-full px-4 py-2"></div>
  </div>
</div>

<!-- Main Content Grid -->
<div class="grid lg:grid-cols-12 gap-8">
  <!-- Main Annual Results Table -->
  <div class="lg:col-span-8">
    {% include 'formteachers/_components/annual_results_table.html' %}
  </div>

  <!-- Sidebar Controls -->
  <div class="lg:col-span-4">
    {% include 'formteachers/_components/annual_publish_controls.html' %}
  </div>
</div>

<!-- Annual Results Management Section -->
<div class="grid lg:grid-cols-2 gap-8 mt-8">
  <!-- Published Annual Results -->
  <div class="bg-base-100 rounded-xl shadow-lg p-6">
    <h6 class="text-lg font-bold text-primary mb-4">Results Published for Your Class</h6>
    <ul id="resultspublished" class="space-y-2"></ul>
  </div>

  <!-- Subject Visibility Controls -->
  <div class="bg-base-100 rounded-xl shadow-lg p-6">
    <h6 class="text-lg font-bold text-primary mb-4">Hide/Show Columns</h6>
    <div class="space-y-2">
      <label class="cursor-pointer label justify-start gap-3">
        <input type="checkbox" class="checkbox checkbox-sm" id="UnhideAllCheckbox" />
        <span class="label-text text-sm">Hide All Subjects</span>
      </label>
      {% for sub in subjects_allocation.subjects.all %}
      <label class="cursor-pointer label justify-start gap-3">
        <input type="checkbox" class="checkbox checkbox-sm column-checkbox" 
               value="{{ forloop.counter }}" id="{{ forloop.counter }}Checkbox" />
        <span class="label-text text-sm">
          <span class="text-primary font-medium">{{ sub.subject_code }}:</span>
          {{ sub.subject_name }}
        </span>
      </label>
      {% endfor %}
    </div>
  </div>
</div>

<script type="module" src="{% static 'js/Teacher_portal/Publish_Annual_Result.js' %}"></script>
{% endblock %}
