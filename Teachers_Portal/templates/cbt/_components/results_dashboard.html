<!-- CBT Results Dashboard Component -->
<div class="space-y-6" id="results-container">
  {% if teacher.FirstName != "None" and teacher.FirstName %}
    <!-- Recent Tests -->
    <div class="bg-base-100 rounded-xl shadow-lg p-6">
      <div class="flex items-center justify-between mb-6">
        <h3 class="text-lg font-bold text-primary flex items-center gap-2">
          <i class="fas fa-clock"></i>
          Recent Test Results
        </h3>
        <button class="btn btn-sm btn-primary" onclick="refreshResults()">
          <i class="fas fa-refresh mr-2"></i>
          Refresh
        </button>
      </div>

      <!-- Tests Table -->
      <div class="overflow-x-auto">
        <table class="table table-zebra">
          <thead>
            <tr>
              <th>Test Name</th>
              <th>Subject</th>
              <th>Classes</th>
              <th>Submissions</th>
              <th>Avg Score</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <!-- Dummy data for demonstration -->
            <tr>
              <td>
                <div class="flex items-center gap-3">
                  <div class="avatar placeholder">
                    <div class="bg-primary text-primary-content rounded-full w-8 h-8">
                      <span class="text-xs">M</span>
                    </div>
                  </div>
                  <div>
                    <div class="font-bold">Mathematics Quiz 1</div>
                    <div class="text-sm opacity-50">Created 2 days ago</div>
                  </div>
                </div>
              </td>
              <td>
                <span class="badge badge-primary">Mathematics</span>
              </td>
              <td>
                <div class="flex flex-wrap gap-1">
                  <span class="badge badge-outline badge-xs">SS1A</span>
                  <span class="badge badge-outline badge-xs">SS1B</span>
                </div>
              </td>
              <td>
                <div class="flex items-center gap-2">
                  <span class="font-bold">45/50</span>
                  <progress class="progress progress-primary w-16" value="90" max="100"></progress>
                </div>
              </td>
              <td>
                <div class="badge badge-success">85%</div>
              </td>
              <td>
                <div class="badge badge-success">Completed</div>
              </td>
              <td>
                <div class="dropdown dropdown-end">
                  <label tabindex="0" class="btn btn-sm btn-ghost">
                    <i class="fas fa-ellipsis-v"></i>
                  </label>
                  <ul tabindex="0" class="dropdown-content menu p-2 shadow bg-base-100 rounded-box w-52">
                    <li><a onclick="viewDetailedResults('1')"><i class="fas fa-chart-bar mr-2"></i>View Results</a></li>
                    <li><a onclick="exportResults('1')"><i class="fas fa-download mr-2"></i>Export Results</a></li>
                    <li><a onclick="analyzeResults('1')"><i class="fas fa-analytics mr-2"></i>Analyze</a></li>
                  </ul>
                </div>
              </td>
            </tr>

            <tr>
              <td>
                <div class="flex items-center gap-3">
                  <div class="avatar placeholder">
                    <div class="bg-secondary text-secondary-content rounded-full w-8 h-8">
                      <span class="text-xs">E</span>
                    </div>
                  </div>
                  <div>
                    <div class="font-bold">English Comprehension</div>
                    <div class="text-sm opacity-50">Created 1 week ago</div>
                  </div>
                </div>
              </td>
              <td>
                <span class="badge badge-secondary">English</span>
              </td>
              <td>
                <div class="flex flex-wrap gap-1">
                  <span class="badge badge-outline badge-xs">SS2A</span>
                </div>
              </td>
              <td>
                <div class="flex items-center gap-2">
                  <span class="font-bold">38/42</span>
                  <progress class="progress progress-secondary w-16" value="90" max="100"></progress>
                </div>
              </td>
              <td>
                <div class="badge badge-warning">72%</div>
              </td>
              <td>
                <div class="badge badge-success">Completed</div>
              </td>
              <td>
                <div class="dropdown dropdown-end">
                  <label tabindex="0" class="btn btn-sm btn-ghost">
                    <i class="fas fa-ellipsis-v"></i>
                  </label>
                  <ul tabindex="0" class="dropdown-content menu p-2 shadow bg-base-100 rounded-box w-52">
                    <li><a onclick="viewDetailedResults('2')"><i class="fas fa-chart-bar mr-2"></i>View Results</a></li>
                    <li><a onclick="exportResults('2')"><i class="fas fa-download mr-2"></i>Export Results</a></li>
                    <li><a onclick="analyzeResults('2')"><i class="fas fa-analytics mr-2"></i>Analyze</a></li>
                  </ul>
                </div>
              </td>
            </tr>

            <tr>
              <td>
                <div class="flex items-center gap-3">
                  <div class="avatar placeholder">
                    <div class="bg-accent text-accent-content rounded-full w-8 h-8">
                      <span class="text-xs">P</span>
                    </div>
                  </div>
                  <div>
                    <div class="font-bold">Physics - Motion</div>
                    <div class="text-sm opacity-50">Active now</div>
                  </div>
                </div>
              </td>
              <td>
                <span class="badge badge-accent">Physics</span>
              </td>
              <td>
                <div class="flex flex-wrap gap-1">
                  <span class="badge badge-outline badge-xs">SS3A</span>
                  <span class="badge badge-outline badge-xs">SS3B</span>
                </div>
              </td>
              <td>
                <div class="flex items-center gap-2">
                  <span class="font-bold">12/36</span>
                  <progress class="progress progress-accent w-16" value="33" max="100"></progress>
                </div>
              </td>
              <td>
                <div class="badge badge-info">Live</div>
              </td>
              <td>
                <div class="badge badge-info">Active</div>
              </td>
              <td>
                <div class="dropdown dropdown-end">
                  <label tabindex="0" class="btn btn-sm btn-ghost">
                    <i class="fas fa-ellipsis-v"></i>
                  </label>
                  <ul tabindex="0" class="dropdown-content menu p-2 shadow bg-base-100 rounded-box w-52">
                    <li><a onclick="monitorTest('3')"><i class="fas fa-eye mr-2"></i>Monitor Live</a></li>
                    <li><a onclick="endTest('3')" class="text-error"><i class="fas fa-stop mr-2"></i>End Test</a></li>
                  </ul>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Performance Analytics -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <!-- Score Distribution -->
      <div class="bg-base-100 rounded-xl shadow-lg p-6">
        <h4 class="text-lg font-bold text-primary mb-4 flex items-center gap-2">
          <i class="fas fa-chart-pie"></i>
          Score Distribution
        </h4>
        <div class="space-y-4">
          <div class="flex items-center justify-between">
            <span class="text-sm">90-100% (Excellent)</span>
            <div class="flex items-center gap-2">
              <progress class="progress progress-success w-24" value="25" max="100"></progress>
              <span class="text-xs font-bold">25%</span>
            </div>
          </div>
          <div class="flex items-center justify-between">
            <span class="text-sm">80-89% (Very Good)</span>
            <div class="flex items-center gap-2">
              <progress class="progress progress-info w-24" value="35" max="100"></progress>
              <span class="text-xs font-bold">35%</span>
            </div>
          </div>
          <div class="flex items-center justify-between">
            <span class="text-sm">70-79% (Good)</span>
            <div class="flex items-center gap-2">
              <progress class="progress progress-warning w-24" value="20" max="100"></progress>
              <span class="text-xs font-bold">20%</span>
            </div>
          </div>
          <div class="flex items-center justify-between">
            <span class="text-sm">60-69% (Fair)</span>
            <div class="flex items-center gap-2">
              <progress class="progress progress-error w-24" value="15" max="100"></progress>
              <span class="text-xs font-bold">15%</span>
            </div>
          </div>
          <div class="flex items-center justify-between">
            <span class="text-sm">Below 60% (Needs Improvement)</span>
            <div class="flex items-center gap-2">
              <progress class="progress progress-error w-24" value="5" max="100"></progress>
              <span class="text-xs font-bold">5%</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Subject Performance -->
      <div class="bg-base-100 rounded-xl shadow-lg p-6">
        <h4 class="text-lg font-bold text-primary mb-4 flex items-center gap-2">
          <i class="fas fa-graduation-cap"></i>
          Subject Performance
        </h4>
        <div class="space-y-4">
          <div class="flex items-center justify-between p-3 bg-primary/10 rounded-lg">
            <div class="flex items-center gap-3">
              <i class="fas fa-calculator text-primary"></i>
              <span class="font-medium">Mathematics</span>
            </div>
            <div class="text-right">
              <div class="font-bold text-primary">88%</div>
              <div class="text-xs text-base-content/60">156 submissions</div>
            </div>
          </div>
          <div class="flex items-center justify-between p-3 bg-secondary/10 rounded-lg">
            <div class="flex items-center gap-3">
              <i class="fas fa-book text-secondary"></i>
              <span class="font-medium">English</span>
            </div>
            <div class="text-right">
              <div class="font-bold text-secondary">82%</div>
              <div class="text-xs text-base-content/60">89 submissions</div>
            </div>
          </div>
          <div class="flex items-center justify-between p-3 bg-accent/10 rounded-lg">
            <div class="flex items-center gap-3">
              <i class="fas fa-atom text-accent"></i>
              <span class="font-medium">Physics</span>
            </div>
            <div class="text-right">
              <div class="font-bold text-accent">75%</div>
              <div class="text-xs text-base-content/60">67 submissions</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="bg-base-100 rounded-xl shadow-lg p-6">
      <h4 class="text-lg font-bold text-primary mb-4 flex items-center gap-2">
        <i class="fas fa-bolt"></i>
        Quick Actions
      </h4>
      <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
        <button class="btn btn-outline btn-primary" onclick="createNewTest()">
          <i class="fas fa-plus mr-2"></i>
          New Test
        </button>
        <button class="btn btn-outline btn-secondary" onclick="exportAllResults()">
          <i class="fas fa-download mr-2"></i>
          Export All
        </button>
        <button class="btn btn-outline btn-accent" onclick="viewAnalytics()">
          <i class="fas fa-chart-line mr-2"></i>
          Analytics
        </button>
        <button class="btn btn-outline btn-info" onclick="manageTests()">
          <i class="fas fa-cog mr-2"></i>
          Manage Tests
        </button>
      </div>
    </div>

  {% else %}
    <!-- Coming Soon State -->
    <div class="bg-base-100 rounded-xl shadow-lg p-12 text-center">
      <div class="flex flex-col items-center gap-6">
        <div class="avatar placeholder">
          <div class="bg-primary/20 text-primary rounded-full w-32 h-32">
            <i class="fas fa-chart-line text-6xl"></i>
          </div>
        </div>
        <div>
          <h3 class="text-2xl font-bold text-primary mb-2">CBT Results Dashboard</h3>
          <p class="text-base-content/70 max-w-md mx-auto">
            Your comprehensive test results and analytics dashboard is being prepared. 
            Complete your profile to unlock powerful insights about your students' performance.
          </p>
        </div>
        <div class="flex gap-4">
          <a href="{% url 'Teachers_portal:profile' teacher.id %}" class="btn btn-primary">
            <i class="fas fa-user-edit mr-2"></i>
            Complete Profile
          </a>
          <button class="btn btn-outline" onclick="learnMore()">
            <i class="fas fa-info-circle mr-2"></i>
            Learn More
          </button>
        </div>
      </div>
    </div>
  {% endif %}
</div>

<script>
// Results dashboard functionality
function refreshResults() {
  // Simulate data refresh
  const toast = document.createElement('div');
  toast.className = 'toast toast-top toast-end';
  toast.innerHTML = `
    <div class="alert alert-success">
      <span>Results refreshed successfully!</span>
    </div>
  `;
  document.body.appendChild(toast);
  setTimeout(() => toast.remove(), 3000);
}

function viewDetailedResults(testId) {
  // Open detailed results modal or navigate to results page
  alert(`Viewing detailed results for test ID: ${testId}`);
}

function exportResults(testId) {
  // Simulate export functionality
  alert(`Exporting results for test ID: ${testId}`);
}

function analyzeResults(testId) {
  // Open analytics view
  alert(`Opening analytics for test ID: ${testId}`);
}

function monitorTest(testId) {
  // Open live monitoring dashboard
  alert(`Monitoring live test ID: ${testId}`);
}

function endTest(testId) {
  if (confirm('Are you sure you want to end this test? Students will no longer be able to submit answers.')) {
    alert(`Test ${testId} has been ended.`);
  }
}

function createNewTest() {
  window.location.href = "{% url 'Teachers_portal:CBT_details' teacher.id %}";
}

function exportAllResults() {
  alert('Exporting all test results...');
}

function viewAnalytics() {
  alert('Opening comprehensive analytics dashboard...');
}

function manageTests() {
  alert('Opening test management interface...');
}

function learnMore() {
  alert('Learn more about CBT features and capabilities...');
}

// Real-time updates for active tests
document.addEventListener('DOMContentLoaded', function() {
  // Simulate real-time updates every 30 seconds
  setInterval(() => {
    // Update submission counts and progress for active tests
    const activeRows = document.querySelectorAll('tr:has(.badge-info)');
    activeRows.forEach(row => {
      const submissionCell = row.querySelector('td:nth-child(4) span');
      if (submissionCell) {
        const [current, total] = submissionCell.textContent.split('/');
        if (parseInt(current) < parseInt(total)) {
          // Simulate new submission
          const newCurrent = Math.min(parseInt(current) + Math.floor(Math.random() * 3), parseInt(total));
          submissionCell.textContent = `${newCurrent}/${total}`;
          
          // Update progress bar
          const progressBar = row.querySelector('progress');
          if (progressBar) {
            progressBar.value = (newCurrent / parseInt(total)) * 100;
          }
        }
      }
    });
  }, 30000);
});
</script>
