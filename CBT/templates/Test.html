{% extends 'base.html' %}
{% load static %}
{% block content%}
{% include 'main_navbar.html' %}

<!-- Test Container -->
<input type="hidden" id="groupname" value="{{questionGroup.name}}">
<input type="hidden" id="grouptestname" value="{{questionGroup.test.name}}">
<input type="hidden" id="studentname" value="{{student.student_name}}">
<input type="hidden" id="studentclass" value="{{student.student_class}}">
<input type="hidden" id="testduration" value="{{total_time}}">

<section class="py-8 bg-base-200 min-h-screen">
    <div class="container mx-auto px-4">
        <!-- Fixed Timer -->
        <div class="fixed bottom-4 left-1/2 transform -translate-x-1/2 z-50">
            <div class="Time_container bg-wine-red text-base-100 px-6 py-3 rounded-full shadow-lg flex items-center gap-3">
                <i class="fa-solid fa-stopwatch text-xl"></i>
                <div class="font-semibold">Time left:</div>
                <div class="font-bold text-lg">
                    <span id="timer"></span>
                </div>
            </div>
        </div>

        <!-- Test Form Container -->
        <div class="test_container bg-base-100 rounded-3xl p-6 shadow-xl mx-auto max-w-4xl">
            <form id="testform" class="space-y-8">
                {% for questionset in questionsetsgroup %}
                <div class="question_set">
                    <div class="question_set_name text-center text-2xl font-bold text-primary mb-6 pb-3 border-b-2 border-primary/20">
                        {{ questionset.subject }}
                    </div>
                    
                    <div class="space-y-6">
                        {% for question in questionset.questions.all %}
                        <div class="card bg-base-100 shadow-lg border-l-4 border-primary/30 hover:border-primary transition-colors">
                            <div class="card-body">
                                <!-- Question Header -->
                                <div class="flex justify-between items-end mb-4">
                                    <div class="flex items-center gap-3">
                                        {% if question.required %}
                                        <span class="badge badge-warning gap-1">
                                            <i class="fa-solid fa-asterisk text-xs"></i>
                                            Required
                                        </span>
                                        {% endif %}
                                        <span class="text-base-content/60 text-sm">Question {{ forloop.counter }}</span>
                                    </div>
                                    <div class="badge badge-primary badge-outline">
                                        {% if question.questionMark == 1 %}
                                            {{ question.questionMark }} mark 
                                        {% else %}
                                            {{ question.questionMark }} marks
                                        {% endif %}
                                    </div>
                                </div>

                                <!-- Question Text -->
                                <h3 class="text-lg font-medium mb-4 leading-relaxed">
                                    {{ question.questiontext|safe }}
                                </h3>

                                <!-- Answer Options -->
                                <div class="space-y-3">
                                    {% for answer in question.answers.all %}
                                    <div class="form-control">
                                        <label class="label cursor-pointer justify-start gap-3 p-3 rounded-lg hover:bg-base-200 transition-colors">
                                            <input type="radio" 
                                                   name="answer{{ question.id }}" 
                                                   id="validationFormCheck{{ answer.id }}"
                                                   class="radio radio-primary" 
                                                   {% if question.required %}{% if forloop.last %} required {% endif %}{% endif %}
                                                   data-iscorrect="{{ answer.isCorrect }}">
                                            <span class="label-text text-base">{{ answer.answertext }}</span>
                                        </label>
                                        {% if forloop.last and question.required %}
                                        <div class="text-error text-sm mt-1 hidden validation-message">
                                            You must select one of the options
                                        </div>
                                        {% endif %}
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endfor %}

                <!-- Submit Section -->
                <div class="flex flex-col items-center space-y-4 pt-8">
                    <div class="alert alert-error hidden" id="validation-alert">
                        <i class="fa-solid fa-triangle-exclamation"></i>
                        <span class="alert-text"></span>
                    </div>
                    <button type="submit" class="btn btn-primary btn-lg px-12">
                        Submit Test
                        <i class="fa-solid fa-paper-plane ml-2"></i>
                    </button>
                </div>
            </form>
        </div>
    </div>
</section>

<!-- Confirmation Modal -->
<dialog id="submitConfirmModal" class="modal">
    <div class="modal-box">
        <h3 class="font-bold text-lg mb-4">
            <i class="fa-solid fa-check-circle text-success mr-2"></i>
            Confirm Submission
        </h3>
        <p class="py-4">
            Are you sure you have gone over your work and you are ready to submit? 
            Once submitted, you cannot make any changes.
        </p>
        <div class="modal-action">
            <button type="button" class="btn btn-ghost" onclick="document.getElementById('submitConfirmModal').close()">
                Cancel
            </button>
            <button id="testsubmit" class="btn btn-primary">
                Submit Test
            </button>
        </div>
    </div>
</dialog>

<!-- Footer -->
<footer class="footer bg-base-200 text-base-content p-4">
    <div class="w-full text-center">
        <p>&copy; 2022 SMSS Omagba, inst. All rights reserved.</p>
        <p class="text-sm opacity-70">Designed by Gozzy designs and development</p>
    </div>
</footer>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="{% static 'js/Student_Portal/Test.js' %}"></script>
{% endblock %}